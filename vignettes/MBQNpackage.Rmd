---
title: "MBQN Package"
author: "A. Schad"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{MBQN Package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# MBQN Package
Mean/Median-balanced quantile normalization for processing omics data

## Description
This package supplies a modified quantile normalization for preprocessing omics or other matrix-like organized data with intensity values biased by global shifts of mean and scatter of columns. The modification balances the mean intensity of features which are rank invariant (RI) or nearly rank invariant (NRI), e.g. features that have always largest intensity across samples/columns, before quantile normalization in order to reduce systematics in downstream analysis. 
## Installation

To install this package from Github, you need R version >= 3.3.3.

For installation from source run in R: 
```{r gh-installation, eval = FALSE}
# install.packages("devtools")
devtools::install_github("arianeschad/mbqn")
```
or
```{r installation, eval = FALSE}
# install.packages("githubinstall")
githubinstall::githubinstall("mbqn")
```

Installation from package binary: <br/>
`install.packages("https://github.com/arianeschad/mbqn/MBQN_0.0.0.9000.tgz", repos = NULL, type = "source")`

Installation from package source: <br/>
`install.packages(https://github.com/arianeschad/mbqn/MBQN_0.0.0.9000.tar.gz",repos = NULL,type = "source")`

## Dependencies: 
The package uses `normalize.quantiles()` from the package preprocessCore by B. Bolstad (2016),  preprocessCore: A collection of pre-processing functions. R package version 1.36.0. available from https://github.com/bmbolstad/preprocessCore: <br/>
`install.packages("preprocessCore")`

Optionally, the limma package can be used for computation of the quantile normalization: <br/>
```{r , eval = FALSE}
install.packages("limma")
```

Collecting data from PRIDE experiments in `example1()` requires the R package rpx by L. Gatto (2017), version 1.10.2. available from https://github.com/lgatto/rpx: <br/>
```{r , eval = FALSE}
install.packages("rpx")
```

In R run <br/>
```{r , eval = FALSE}
install.packages(pkgs = c("preprocessCore","limma","rpx"), dependencies = TRUE)
```


## Additional Dependencies: 
Additional packages needed to run MBQN and examples: install.packages(pkgs = c(“filesstrings”), dependencies = TRUE)

After installation, check the `?mbqn.demo` and the `?mbqn.example1` help files to see full working examples with further documentation.

## Basic Usage
The package provides two basic functions: `mbqn()` applies quantile normalization or mean-balanced quantile normalization to a matrix. `mbqn.nri()` applies quantile normalization and mean balanced quantile normalization only to selected nearly rank invariant and rank invariant features, specified by a threshold or manually. The input matrix may contain NAs. To run one of these functions you will need to provide an input matrix similar to the data matrix in `mbqn.demo` or `mbqn.example1`. The argument `FUN` is used to select between classical quantile normalization (default), and mean or median balanced quantile normalization. The function `mbqn.check_saturation()` can be used to check a data matrix for rank or nearly rank invariant features. It provides a list of potential RI/NRI features, a rank invariance frequency, and a graphical output. 

## Examples
1. Generate a simple matrix, apply median-balanced quantile normalization, generate a boxplot of normalized features and check for rank invariant (RI) or nearly rank invariant (NRI) features:

```{r example, eval = FALSE}
## basic example
mtx <- matrix(c(5,2,3,NA,4,1,4,2,3,4,6,NA),ncol=3)
mtx.norm <- MBQN::mbqn(x = mtx, FUN = median)
MBQN::mbqn.boxplot(mtx.norm, irow = 1,)
MBQN::mbqn.check_saturation(mtx,FUN = median,low_thr = 0.1, filename = "simple_mtx",feature_index = 1)
```

2. This example will download data with LFQ intensities from the PRIDE repository, normalize the data, identifies RI/NRI features, and give graphical output. By default, files are stored in the current working directory in the folder /examples/PXDxxx.

```{r, eval = FALSE}
## example using LFQ intensity data from the PRIDE repository
mbqn.example1(which.example = 3, source.path = "/examples")
```

To run `mbqn.example1()` for data from the PRIDE archive, the respective proteinGroups.txt file must be downloaded from the PRIDE webpage to the folder /examples/PXDxxxx/ in advance or directly by running the code included in `exmple1()`. One can choose between four data sets. 

## Figures
Figures created with MBQN are saved in the current working directory.

## References
A. Schad and C. Kreutz, MBQN: R package for mean balanced quantile normalization. In prep. for Bioinf. Appl. Note, 2018

